<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DTR Telemetry â€“ Performance Analytics</title>
  <link rel="stylesheet" href="style.css?v=2.2">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.documentElement.setAttribute("data-theme", localStorage.getItem("theme") || "f1");
  </script>
</head>
<body>

<div class="container telemetry-page">
  <!-- Header: compact single row -->
  <header class="telemetry-header card">
    <div class="telemetry-header-inner">
      <h1>Productivity Telemetry</h1>
      <div class="telemetry-header-actions">
        <label for="weekSelect" class="telemetry-label">Window</label>
        <select id="weekSelect" class="telemetry-select" onchange="updateView()">
          <option value="all">Full OJT Span</option>
        </select>
        <button class="telemetry-btn" onclick="window.location.href='index.html'">Back to DTR</button>
      </div>
    </div>
  </header>

  <!-- Section: Key metrics (2 rows Ã— 3 cols) -->
  <section class="telemetry-section">
    <h2 class="section-title">Overview</h2>
    <div class="telemetry-stats-grid">
      <div class="card stat-card" id="forecastCard">
        <h3>OJT Forecast</h3>
        <p id="remainingHoursText" class="stat-value stat-accent">0 hrs remaining</p>
        <p id="completionDateText" class="stat-sub">Projected: TBD</p>
        <small id="avgPaceNote" class="stat-note">Based on current pace</small>
      </div>
      <div class="card stat-card" id="paceCalculatorCard">
        <h3>Required Pace</h3>
        <div class="stat-rows">
          <div class="stat-row"><span>Remaining</span><span id="remHoursPace" class="stat-accent">0h</span></div>
          <div class="stat-row"><span>Days left</span><span id="remDaysPace">0</span></div>
          <div class="stat-row"><span>Need</span><span id="reqPaceValue" class="stat-excellent">0.0h/day</span></div>
          <div class="stat-row"><span>Last 7d avg</span><span id="last7DayPace">0.0h/day</span></div>
        </div>
        <p id="paceStatusMsg" class="stat-msg">Calculatingâ€¦</p>
      </div>
      <div class="card stat-card" id="efficiencyCard">
        <h3>Efficiency</h3>
        <div class="stat-rows">
          <div class="stat-row"><span>Time (Act/Plan)</span><span id="timeEffValue">0%</span></div>
          <div class="stat-row"><span>Energy (Blocks/Hr)</span><span id="energyEffValue">0%</span></div>
        </div>
      </div>
      <div class="card stat-card" id="recoveryCard">
        <h3>Recovery & Fatigue</h3>
        <div class="stat-status">
          <span id="fatigueIndicator" class="stat-emoji">ðŸŸ¢</span>
          <span id="fatigueLabel" class="stat-status-label">Stable</span>
        </div>
        <small id="fatigueNote" class="stat-note">Sustainability</small>
      </div>
      <div class="card stat-card" id="cogLoadCard">
        <h3>Cognitive Load</h3>
        <div class="stat-status">
          <span id="cogIndicator" class="stat-emoji">ðŸ”‹</span>
          <span id="cogLabel" class="stat-status-label">Normal</span>
        </div>
        <small id="cogNote" class="stat-note">OJT + Personal</small>
      </div>
      <div class="card stat-card" id="momentumCard">
        <h3>Momentum</h3>
        <div class="stat-rows">
          <div class="stat-row"><span>Index</span><span id="momentumValue">0%</span></div>
          <div class="stat-row"><span>Streak (â‰¥8h)</span><span id="streakValue">0 days</span></div>
        </div>
        <p id="momentumStatus" class="stat-msg">Stability</p>
      </div>
    </div>
  </section>

  <!-- Main chart: trajectory -->
  <section class="telemetry-section">
    <h2 class="section-title">Cumulative Progress vs Goal</h2>
    <div class="card chart-card chart-card-wide">
      <div class="chart-wrap chart-tall">
        <canvas id="trajectoryChart"></canvas>
      </div>
    </div>
  </section>

  <!-- Daily performance: delta + hour distribution -->
  <section class="telemetry-section">
    <h2 class="section-title">Daily Performance</h2>
    <div class="telemetry-charts-row">
      <div class="card chart-card">
        <h3>Session Delta (vs 8h)</h3>
        <div class="chart-wrap">
          <canvas id="deltaChart"></canvas>
        </div>
      </div>
      <div class="card chart-card">
        <h3>Hours Distribution</h3>
        <div class="chart-wrap">
          <canvas id="hourDistChart"></canvas>
        </div>
      </div>
    </div>
  </section>

  <!-- Weekly trend -->
  <section class="telemetry-section">
    <h2 class="section-title">Weekly Velocity</h2>
    <div class="card chart-card chart-card-wide">
      <div class="chart-wrap">
        <canvas id="weeklyTrendChart"></canvas>
      </div>
    </div>
  </section>

  <!-- L2 & wellness -->
  <section class="telemetry-section">
    <h2 class="section-title">L2 Telemetry & Wellness</h2>
    <div class="telemetry-charts-row telemetry-charts-three">
      <div class="card stat-card">
        <h3>L2 Scores</h3>
        <div class="stat-rows">
          <div class="stat-row"><span>Commute use</span><span id="commuteEff">0%</span></div>
          <div class="stat-row"><span>Deep work</span><span id="deepWorkScore">0.0</span></div>
          <div class="stat-row"><span>Avg sleep</span><span id="avgSleep">0.0h</span></div>
        </div>
      </div>
      <div class="card chart-card">
        <h3>Identity Alignment</h3>
        <div class="chart-wrap">
          <canvas id="identityChart"></canvas>
        </div>
      </div>
      <div class="card chart-card">
        <h3>Energy Zones</h3>
        <div class="chart-wrap">
          <canvas id="energyZoneChart"></canvas>
        </div>
      </div>
    </div>
  </section>

  <div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner"></div>
    <p>Syncing telemetryâ€¦</p>
  </div>
</div>

<script src="telemetry.js"></script>
</body>
</html>
